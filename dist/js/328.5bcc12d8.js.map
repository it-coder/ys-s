{"version":3,"file":"js/328.5bcc12d8.js","mappings":"0NAAO,MAAMA,EACX,iEAGWC,EAAiB,yC,4VCsBxBC,GAASC,EAAAA,EAAAA,IAAI,MACbC,GAAQD,EAAAA,EAAAA,IAAI,CAAC,GAcnB,SAASE,KACPC,EAAAA,EAAAA,IAAMJ,GAAQK,YAAY,CACxBC,OAAQ,mBAEZ,CACA,SAASC,EAAQC,GACfA,EAAKC,KAAKC,IACR,MAAMC,EAAWD,EAAIR,MACrB,IAAK,IAAKU,EAAGC,KAAMC,OAAOC,QAAQJ,GAChCA,EAASC,IAAMC,GAGHT,EAAAA,EAAAA,IAAMJ,GAAQK,YAAY,CACtCC,OAAQ,mBACRK,WACAK,QAASC,KAAKC,UAAUR,GAMxBS,WAAYT,EAAIU,KAChBC,YAAaX,EAAIY,QAEjBC,QAASb,EAAIc,WAAa,GAC1BC,SAAU,GACVC,OAAQ,EACRC,UAAW,CACTC,EAAG,IACHC,EAAG,KAMLC,WAAW,EACXC,aAAa,EACbC,0BAA0B,EAC1BC,cAAe,KACf,GAEN,CAIA,SAASC,IACPC,MAAMrC,EAAe,CACnBsC,OAAQ,SAEPC,MAAMC,GAAOA,EAAGC,SAChBF,MAAMC,IACL,GAAgB,IAAZA,EAAGE,OAAeF,EAAGG,KAAKC,MAC5B,OAEF,IAAIC,EAAO5C,EAAiB,UAAYuC,EAAGG,KAAKC,MAC5CE,EAAS,IAAIC,gBAAgBlC,SAASiC,QAE1C,MAAME,EAASC,OAAOD,OAAOE,QAC7BhD,EAAOiD,MAAQ,IAAIH,EAAO,CACxBI,IAAKC,SAASC,eAAe,UAC7BC,aAAcV,EACdW,MAA+B,SAAxBV,EAAOW,IAAI,WAGpBC,EAAK,iBAAkBxD,EAAOiD,QAE9B7C,EAAAA,EAAAA,IAAMJ,GAAQyD,yBAAyB,aAAchB,IACnD,MAAMiB,EAAIzC,KAAK0C,MAAMlB,GAEJ,aAAbiB,EAAEpD,QACJkD,EAAK,aAAcvC,KAAK0C,MAAMD,EAAE1C,UAGjB,cAAb0C,EAAEpD,OACJJ,EAAM+C,MAAQS,EAEdxD,EAAM+C,MAAQ,IAChB,GACA,IAEHW,OAAOC,GAAOC,QAAQC,MAAMF,IACjC,C,OA7FAG,EAAAA,EAAAA,KACE,IAAMC,EAAMC,SACZ,KAAM,IAAAC,GACY,QAAZA,EAAAF,EAAMC,cAAM,IAAAC,OAAA,EAAZA,EAAcC,QAAS,GACzBC,YAAW,KACTlE,IACAI,EAAQ0D,EAAMC,OAAO,GACpB,IACL,GAEF,CAAEI,WAAW,IA6CfpC,I,sIC9EA,MAAMqC,GAA2B,OAAgB,EAAQ,CAAC,CAAC,YAAY,qBAEvE,O","sources":["webpack://cdm-screen/./src/config/engine.js","webpack://cdm-screen/./src/pages/engine/index.vue","webpack://cdm-screen/./src/pages/engine/index.vue?db62"],"sourcesContent":["export const engineHttpUrl =\n  \"https://www.lscdm.com/jianMoApi/api/open/client/default_player\";\n// \"http://20.21.1.112:3032/api/open/client/default_player\";\n\nexport const engineWsPrefix = \"wss://www.lscdm.com/jianMoWs/ws/player\";\n// export const engineWsPrefix = \"ws://20.21.1.112:3032/ws/player\";\n","<template>\n  <div class=\"engine\">\n    <div class=\"current-point\" v-if=\"!isBackground\">\n      {{ point }}\n    </div>\n    <div id=\"engine\" class=\"engine-container\"></div>\n  </div>\n</template>\n\n<script setup>\nimport { ref, unref, watch } from \"vue\";\nimport { engineHttpUrl, engineWsPrefix } from \"/@/config/engine.js\";\n\nconst props = defineProps({\n  isBackground: {\n    default: false,\n    type: Boolean,\n  },\n  points: {\n    default: () => [],\n    type: Array,\n  },\n});\n\nconst emit = defineEmits([\"onEngineLoaded\", \"onPopClick\"]);\n\nconst engine = ref(null);\nconst point = ref({});\n\nwatch(\n  () => props.points,\n  () => {\n    if (props.points?.length > 0) {\n      setTimeout(() => {\n        clearDots();\n        addDots(props.points);\n      }, 2000);\n    }\n  },\n  { immediate: true }\n);\nfunction clearDots() {\n  unref(engine).sendMessage({\n    action: \"marker.clearAll\",\n  });\n}\nfunction addDots(pois) {\n  pois.map((poi) => {\n    const location = poi.point;\n    for (let [k, v] of Object.entries(location)) {\n      location[k] = +v;\n    }\n\n    const msgId = unref(engine).sendMessage({\n      action: \"marker.createpop\",\n      location,\n      payload: JSON.stringify(poi),\n      // offsetVector: {\n      //   X: 0,\n      //   Y: 0,\n      //   Z: 100,\n      // },\n      firstlevel: poi.type,\n      secondlevel: poi.subType,\n      // url: \"www.baidu.com\",\n      popname: poi.pointName || \"\",\n      fronsize: 12,\n      status: 0,\n      webuisize: {\n        X: 1000,\n        Y: 450,\n      },\n      // webuioffset: {\n      //   X: 20,\n      //   Y: 0,\n      // },\n      breakdown: false,\n      hadWebClick: true,\n      SapacePopHadNoHoverColor: true,\n      visibleheight: 5000,\n    });\n  });\n}\n\ninitEngine();\n\nfunction initEngine() {\n  fetch(engineHttpUrl, {\n    method: \"POST\",\n  })\n    .then((es) => es.json())\n    .then((es) => {\n      if (es.code !== 0 || !es.data.token) {\n        return;\n      }\n      let link = engineWsPrefix + \"?token=\" + es.data.token;\n      let search = new URLSearchParams(location.search);\n\n      const Engine = window.Engine.default;\n      engine.value = new Engine({\n        dom: document.getElementById(\"engine\"),\n        directServer: link,\n        debug: search.get(\"debug\") === \"true\",\n      });\n\n      emit(\"onEngineLoaded\", engine.value);\n\n      unref(engine).addResponseEventListener(\"onMessage\", (data) => {\n        const _ = JSON.parse(data);\n\n        if (_.action === \"PopClick\") {\n          emit(\"onPopClick\", JSON.parse(_.payload));\n        }\n\n        if (_.action === \"MeshClick\") {\n          point.value = _;\n        } else {\n          point.value = null;\n        }\n      });\n    })\n    .catch((ex) => console.error(ex));\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.current-point {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 200px;\n  height: 200px;\n  background: #fff;\n  z-index: 99;\n  font-size: 12px;\n}\n</style>\n","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=72712605&lang=scss&scoped=true\"\n\nimport exportComponent from \"../../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-72712605\"]])\n\nexport default __exports__"],"names":["engineHttpUrl","engineWsPrefix","engine","ref","point","clearDots","unref","sendMessage","action","addDots","pois","map","poi","location","k","v","Object","entries","payload","JSON","stringify","firstlevel","type","secondlevel","subType","popname","pointName","fronsize","status","webuisize","X","Y","breakdown","hadWebClick","SapacePopHadNoHoverColor","visibleheight","initEngine","fetch","method","then","es","json","code","data","token","link","search","URLSearchParams","Engine","window","default","value","dom","document","getElementById","directServer","debug","get","emit","addResponseEventListener","_","parse","catch","ex","console","error","watch","props","points","_props$points","length","setTimeout","immediate","__exports__"],"sourceRoot":""}